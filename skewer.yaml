title: Skupper FTP
github_actions_url: https://github.com/skupperproject/skewer/actions/workflows/main.yaml
prerequisites: !string prerequisites
contexts:
  west:
    kubeconfig: ~/.kube/config-west
    namespace: west
  east:
    kubeconfig: ~/.kube/config-east
    namespace: east
steps:
  - standard: configure_separate_console_sessions
  - standard: set_up_your_clusters
  - standard: set_up_your_namespaces
  - standard: install_skupper_in_your_namespaces
  - standard: check_the_status_of_your_namespaces
  - title: Link your namespaces
    preamble: !string link_your_namespaces_preamble
    commands:
      west:
        - run: skupper token create ~/west.token
      east:
        - run: skupper link create ~/west.token
        - run: skupper link status --wait 30
    postamble: !string link_your_namespaces_postamble
  - title: Deploy the FTP service
    commands:
      east:
        - run: kubectl apply -f ftp-service.yaml
          await: [deployment/ftp-service]
  - title: Expose the FTP service
    commands:
      east:
        # Only the first has an effect
        - run: skupper expose deployment/ftp-service --port 2020
        - run: skupper expose deployment/ftp-service --port 2121
          sleep: 30
        # Also tried:
        # - run: skupper expose deployment/ftp-service --port 2020 --port 2121
        # It let's me try, and only the latter port is in effect
  - title: Test the FTP service
    commands:
      west:
        - run: kubectl run ftp-put --rm -it --image=docker.io/curlimages/curl -- -T /etc/services ftp://example:example@ftp-service:2121
        - run: kubectl run ftp-get --rm -it --image=docker.io/curlimages/curl -- ftp://example:example@ftp-service:2121/services
cleaning_up:
  preamble: !string cleaning_up_preamble
  commands:
    west:
      - run: skupper delete
    east:
      - run: skupper delete
      - run: kubectl delete deployment/ftp-service
next_steps: !string next_steps
