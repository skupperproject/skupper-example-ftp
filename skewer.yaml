title: Skupper FTP
subtitle: XXX
github_actions_url: https://github.com/skupperproject/skewer/actions/workflows/main.yaml
overview: |
  XXX
prerequisites: !string prerequisites
contexts:
  west:
    kubeconfig: ~/.kube/config-west
    namespace: west
  east:
    kubeconfig: ~/.kube/config-east
    namespace: east
steps:
  - title: Configure separate console sessions
    preamble: !string configure_separate_console_sessions_preamble
    commands:
      west:
        - run: export KUBECONFIG=~/.kube/config-west
      east:
        - run: export KUBECONFIG=~/.kube/config-east
  - title: Log in to your clusters
    preamble: !string log_in_to_your_clusters_preamble
  - title: Set up your namespaces
    preamble: !string set_up_your_namespaces_preamble
    commands:
      west:
        - run: kubectl create namespace west
        - run: kubectl config set-context --current --namespace west
      east:
        - run: kubectl create namespace east
        - run: kubectl config set-context --current --namespace east
  - title: Install Skupper in your namespaces
    preamble: !string install_skupper_in_your_namespaces_preamble
    commands:
      west:
        - run: skupper init
          await: [deployment/skupper-service-controller, deployment/skupper-router]
      east:
        - run: skupper init --ingress none
          await: [deployment/skupper-service-controller, deployment/skupper-router]
    postamble: |
      Here we are using `--ingress none` in `east` simply to make
      local development with Minikube easier.  (It's tricky to run two
      minikube tunnels on one host.)  The `--ingress none` option is
      not required if your two namespaces are on different hosts or on
      public clusters.
  - title: Check the status of your namespaces
    preamble: !string check_the_status_of_your_namespaces_preamble
    commands:
      - run: skupper status
        output: |
          Skupper is enabled for namespace "west" in interior mode. It is not connected to any other sites. It has no exposed services.
          The site console url is: http://10.98.13.241:8080
          The credentials for internal console-auth mode are held in secret: 'skupper-console-users'
  - title: Link your namespaces
    preamble: !string link_your_namespaces_preamble
    commands:
      west:
        - run: skupper token create ~/west.token
      east:
        - run: skupper link create ~/west.token
        - run: skupper link status --wait 30
    postamble: !string link_your_namespaces_postamble
  - title: Deploy the FTP service
    preamble: |
      XXX
    commands:
      east:
        - run: kubectl apply -f ftp-service.yaml
          await: [deployment/ftp-service]
  - title: Expose the FTP service
    preamble: |
      XXX
    commands:
      east:
        - run: skupper expose deployment/ftp-service --port 2020 --port 2121
          sleep: 30
  - title: Test the FTP service
    preamble: |
      XXX
    commands:
      west:
        - run: kubectl run ftp-put --rm -it --image=docker.io/curlimages/curl -- -T /etc/services ftp://example:example@ftp-service:2121
        - run: kubectl run ftp-get --rm -it --image=docker.io/curlimages/curl -- ftp://example:example@ftp-service:2121/services
cleaning_up:
  preamble: !string cleaning_up_preamble
  commands:
    west:
      - run: skupper delete
    east:
      - run: skupper delete
      - run: kubectl delete deployment/ftp-service
next_steps: !string next_steps
